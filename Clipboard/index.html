<!DOCTYPE html>
<html>
    <head>
        <title>Clipboard Viewer</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
<body>

<h2>Clipboard Viewer</h2>

<div id="pasteArea" contenteditable style="border: 1px solid gray;"></div>
<div id="typeList"></div>
<div id="htmlContent" style="border-top: solid 1px gray; border-bottom: solid 1px gray;">
    You can simply paste your content directly into the box by using the keyboard shortcut
    or paste into the box. It will display all the data from your clipboard.
    You can then utilize the browser's Translation function to translate the content.
    It supports various formats, and you can paste your content repeatedly as needed.
</div>
<div>
    <a href="https://github.com/ChrisTorng/InfoProcess/" target="_blank">GitHub source</a>,
    <a href="https://github.com/ChrisTorng/InfoProcess/issues" target="_blank">report issues</a>
</div>

<script>
let dataMap = new Map();
const typeList = document.getElementById('typeList');
let typeListHtml = '';
const htmlContent = document.getElementById('htmlContent');
document.addEventListener('paste', function(e) {
    e.preventDefault();
    
    dataMap = new Map();
    typeListHtml = '';
    e.clipboardData.types.forEach(type => {
        let data = e.clipboardData.getData(type);
        if (type === 'text/plain') {
            data = `<pre>${data}</pre>`;            
        }
        dataMap.set(type, data);
    });

    if (dataMap.size === 0) {
        typeList.innerHTML = 'No data found in clipboard';
        return;
    }

    setType('text/html') || setType('text/plain')  || setType(dataMap.keys[0]);
});

function setType(type) {
    if (!dataMap.has(type)) {
        return false;
    }

    htmlContent.innerHTML = dataMap.get(type);
    for (let key of dataMap.keys()) {
        if (key === type) {
            typeListHtml += `<a href="#${key}"><b>${key}</b></a> | `;
        } else {
            typeListHtml += `<a href="#${key}">${key}</a> | `;
        }
    }
    typeListHtml = typeListHtml.substring(0, typeListHtml.length - 2);
    typeList.innerHTML = typeListHtml;
    location = `#${type}`;
    return true;
}

window.addEventListener("hashchange", function(event) {
    event.preventDefault();

    const hash = window.location.hash.slice(1);
    if (dataMap.size === 0 || !hash) {
        return;
    }

    typeListHtml = '';
    setType(hash) || setType('text/html') || setType('text/plain')  || setType(dataMap.keys[0]);
}, false);

</script>

</body>
</html>
